using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

using CarDataService;
using System.Configuration;
using System.Threading;


namespace TestApp
{
    class Program
    {
        static void Main(string[] args)
        {
            while (true)
            {
                    string data = @"$NMGT;1;45808.821494;1456681422.800000;20160128-17:43:42.799;33.385008;-84.316173;227.170000;0.106862;1231321.495485;2250948.584399;0.000000;81.562500;56;0.136719;0;100;0;0.000000;0.000000;0.961167
                    $NMGT; 1; 45809.021295; 1456681423.000000; 20160128 - 17:43:43.000; 33.385008; -84.316173; 227.170000; 0.583077; 1231321.495485; 2250948.584399; 0.000000; -133.593750; 56; 0.136719; 0; 100; 0; 0.000000; 0.000000; 0.961167
                    $NMGT; 3; 45808.821494; 1456681422.800000; 20160128 - 17:43:42.799; 33.384872; -84.315713; 227.150000; 0.003677; 1231271.735996; 2251089.100640; 0.000000; -106.171875; 58; 0.068359; 0; 100; 0; 0.000000; 0.000000; 0.942078
                    $NMGT; 3; 45809.021295; 1456681423.000000; 20160128 - 17:43:43.000; 33.384872; -84.315713; 227.150000; -1.146574; 1231271.735996; 2251089.100640; 0.000000; 9.843750; 58; 0.068359; 0; 100; 0; 0.000000; 0.000000; 0.942078
                    $NMGT; 4; 45808.821494; 1456681422.800000; 20160128 - 17:43:42.799; 33.384918; -84.315873; 227.150000; 0.736496; 1231288.579658; 2251040.104575; 0.000000; 108.984375; 59; 0.068359; 0; 100; 0; 0.000000; 0.000000; 0.948807
                    $NMGT; 4; 45809.021295; 1456681423.000000; 20160128 - 17:43:43.000; 33.384918; -84.315873; 227.150000; -1.153204; 1231288.579658; 2251040.104575; 0.000000; -4.218750; 59; 0.068359; 0; 100; 0; 0.000000; 0.000000; 0.948807
                    $NMGT; 2; 45808.821494; 1456681422.800000; 20160128 - 17:43:42.799; 33.384672; -84.315037; 227.160000; -0.814603; 1231198.583809; 2251295.131975; 0.000000; 14.765625; 49; 0.136719; 0; 0; 0; 0.000000; 0.000000; 0.913049
                    $NMGT; 2; 45809.021295; 1456681423.000000; 20160128 - 17:43:43.000; 33.384672; -84.315037; 227.180000; -0.500130; 1231198.583809; 2251295.131975; 0.000000; 32.343750; 49; 0.136719; 0; 0; 0; 0.000000; 0.000000; 0.913049
                    $NMGT; 5; 45808.821494; 1456681422.800000; 20160128 - 17:43:42.799; 33.384804; -84.315481; 227.120000; -0.803140; 1231246.779749; 2251159.704208; 0.000000; 28.828125; 54; 0.068359; 0; 0; 0; 0.000000; 0.000000; 0.931981
                    $NMGT; 5; 45809.021295; 1456681423.000000; 20160128 - 17:43:43.000; 33.384804; -84.315481; 227.120000; 0.444006; 1231246.779749; 2251159.704208; 0.000000; 97.734375; 54; 0.205078; 0; 0; 0; 0.000000; 0.000000; 0.931981
                    $NMGT; 6; 45808.821494; 1456681422.800000; 20160128 - 17:43:42.799; 33.384987; -84.316099; 227.180000; -0.654980; 1231313.838500; 2250971.343719; 0.000000; -67.500000; 51; 0.068359; 0; 100; 0; 0.000000; 0.000000; 0.958449
                    $NMGT; 6; 45809.021295; 1456681423.000000; 20160128 - 17:43:43.000; 33.384987; -84.316099; 227.180000; -0.752842; 1231313.868961; 2250971.369347; 0.000000; -60.468750; 51; 0.068359; 0; 100; 0; 0.000000; 0.000000; 0.958448
                    $NMGT; 7; 45808.821494; 1456681422.800000; 20160128 - 17:43:42.799; 33.384275; -84.314048; 227.540000; -0.61";

                    MessageBuffer mb = new MessageBuffer();
                    List<string> msgs = mb.AddData(data);
            
                    var evh = new EventHubSubscriber();

                    evh.ConnectionString = ConfigurationManager.AppSettings["EventHubConnectionString"];
                    evh.EventHubName = ConfigurationManager.AppSettings["EventHubName"];

                    msgs.ForEach(m => {
                        evh.OnNext(m);
                        Console.WriteLine(m);
                
                     }); ;
                System.Threading.Thread.Sleep(1000);
            }

        }
    }
}
